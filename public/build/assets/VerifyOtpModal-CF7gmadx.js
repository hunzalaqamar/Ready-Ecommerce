import{D as N,n as U,u as Y,d,p as F,c as a,o as s,b as n,w as x,g as c,Y as R,a as u,M as j,N as q,q as E,O as G,t as i,h as _,S as k,F as Q,r as H,A as J,B as W,T as I,Q as X,K as V}from"./app-5e4c1E4T.js";const Z={class:"fixed inset-0 z-10 w-screen overflow-y-auto"},ee={class:"flex min-h-full items-center justify-center p-4 text-center sm:p-0"},te={class:"text-slate-950 text-lg sm:text-2xl font-medium leading-loose"},ae={key:0,class:"text-slate-950 mt-3 text-lg font-normal leading-7 tracking-tight"},se={key:1},oe={class:"flex gap-3 mt-6"},le=["id","onUpdate:modelValue","onInput","onKeydown"],ne={key:2},ie={key:1,type:"button",class:"px-6 py-4 bg-primary-200 mt-6 rounded-[10px] text-primary text-base font-medium w-full flex items-center justify-center gap-2",disabled:""},re={key:3},ue={key:4,class:"px-4 py-2 mt-6 flex items-center justify-center gap-2"},de={class:"text-slate-900 text-base font-normal leading-normal"},ce={key:0,class:"text-primary text-base font-normal leading-normal"},me={key:1},pe={key:5,class:"px-4 py-2 mt-6 flex items-center justify-center gap-2"},ve={key:1,type:"button",class:"rounded-[10px] text-primary text-base font-medium w-full flex justify-center items-center gap-1"},ye={__name:"VerifyOtpModal",props:{showModal:{type:Boolean,default:!1}},emits:["hideModal"],setup(O,{emit:C}){const S=C,f=N(),y=U(),r=Y(),h=d(!1),g=d(!1),m=d(""),T=d(""),D=O;F(D,()=>{D.showModal&&B()});const M=d(null),P=()=>{S("hideModal",!1),v.value=[{value:""},{value:""},{value:""},{value:""}],h.value=!1,g.value=!1,D.showModal=!1,clearTimeout(M.value),p.value=60},p=d(60),$=()=>{p.value>0?M.value=window.setTimeout(()=>{p.value-=1,$()},1e3):clearTimeout(M.value)},v=d([{value:""},{value:""},{value:""},{value:""}]),L=e=>{let t=e+1;t<v.value.length&&v.value[e].value!=""&&V(()=>{const l=document.getElementById("input"+t);l&&l.focus()})},z=(e,t)=>{if(t.key==="Backspace"&&e>0&&v.value[e].value===""){let l=e-1;l>=0&&V(()=>{const o=document.getElementById("input"+l);o&&o.focus()})}},b=d(""),B=()=>{var e,t,l;if(r.register_otp_type=="email"?b.value=(e=y.user)==null?void 0:e.email:b.value=(t=y.user)==null?void 0:t.phone,!b.value){f.error("Your account is not complete. Please complete your account first",{position:r.langDirection==="rtl"?"bottom-right":"bottom-left"});return}g.value=!0,axios.post("/send-otp",{phone:b.value,phone_code:(l=y.user)==null?void 0:l.phone_code}).then(o=>{g.value=!1,p.value=60,$(),f.success(o.data.message,{position:r.langDirection==="rtl"?"bottom-right":"bottom-left"}),T.value=o.data.message,m.value=o.data.data.email_or_phone}).catch(o=>{console.log(o.response),g.value=!1,f.error(o.response.data.message,{position:r.langDirection==="rtl"?"bottom-right":"bottom-left"})})},A=()=>{h.value=!0;const e=v.value.map(t=>t.value).join("");axios.post("/verify-otp",{phone:m.value,otp:e}).then(t=>{h.value=!1,f.success(t.data.message,{position:r.langDirection==="rtl"?"bottom-right":"bottom-left"}),P(),K()}).catch(t=>{h.value=!1,f.error(t.response.data.message,{position:r.langDirection==="rtl"?"bottom-right":"bottom-left"})})},K=()=>{axios.get("/profile",{headers:{Authorization:y.token,"Accept-Language":r.locale||"en"}}).then(e=>{y.setUser(e.data.data.user)}).catch(e=>{console.log(e)})};return(e,t)=>(s(),a("div",null,[n(c(X),{as:"template",show:O.showModal},{default:x(()=>[n(c(R),{as:"div",class:"relative z-10"},{default:x(()=>[n(c(j),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:x(()=>t[2]||(t[2]=[u("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-50 transition-opacity"},null,-1)])),_:1}),u("div",Z,[u("div",ee,[n(c(j),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:x(()=>[n(c(q),{class:"relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all my-8 md:my-0 w-full sm:max-w-lg md:max-w-xl"},{default:x(()=>[u("div",{class:E(["bg-white p-5 sm:p-8 relative",c(r).langDirection==="rtl"?"text-right":"text-left"])},[u("div",{class:E(["w-9 h-9 bg-slate-100 rounded-[32px] absolute top-4 flex justify-center items-center cursor-pointer",c(r).langDirection==="rtl"?"left-4":"right-4"]),onClick:t[0]||(t[0]=l=>P())},[n(c(G),{class:"w-6 h-6 text-slate-600"})],2),u("div",te,i(e.$t("Enter OTP")),1),T.value&&m.value?(s(),a("div",ae,[_(i(T.value)+" ",1),t[3]||(t[3]=u("br",null,null,-1)),_(" "+i(m.value),1)])):(s(),a("div",se,[n(k,{class:"w-8/12 h-4 rounded-lg mt-2"}),n(k,{class:"w-11/12 h-4 rounded-lg mt-2"})])),u("div",oe,[(s(!0),a(Q,null,H(v.value,(l,o)=>J((s(),a("input",{key:o,id:"input"+o,type:"text","onUpdate:modelValue":w=>l.value=w,onInput:w=>L(o),onKeydown:w=>z(o,w),placeholder:"-",class:"text-base font-normal w-10 grow text-center p-3 placeholder:text-slate-400 rounded-lg border border-slate-200 focus:border-primary outline-none",maxlength:"1"},null,40,le)),[[W,l.value]])),128))]),m.value?(s(),a("div",ne,[h.value?(s(),a("button",ie,[_(i(e.$t("Processing"))+" ",1),n(I)])):(s(),a("button",{key:0,class:"px-6 py-4 bg-primary mt-6 rounded-[10px] text-white text-base font-medium w-full",onClick:A},i(e.$t("Confirm OTP")),1))])):(s(),a("div",re,[n(k,{class:"w-full h-12 rounded-lg mt-6"})])),p.value>0?(s(),a("div",ue,[u("div",de,i(e.$t("Resend code in")),1),m.value?(s(),a("div",ce," 00:"+i(p.value)+" "+i(e.$t("sec")),1)):(s(),a("div",me,[n(k,{class:"w-16 h-4 rounded-lg"})]))])):(s(),a("div",pe,[g.value?(s(),a("button",ve,[_(i(e.$t("Sending"))+" ",1),n(I)])):(s(),a("button",{key:0,type:"button",class:"text-primary text-base font-normal leading-normal",onClick:t[1]||(t[1]=l=>B())},i(e.$t("Resend OTP")),1))]))],2)]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])]))}};export{ye as _};
